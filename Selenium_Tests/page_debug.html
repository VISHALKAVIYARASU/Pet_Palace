<html lang="en"><head>
    <meta charset="UTF-8">
    <title>Login - Pet Palace</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light d-flex align-items-center justify-content-center vh-100">
    <div class="card shadow p-4" style="max-width: 420px; width: 100%;">
        <h2 class="text-center mb-4 text-primary">Login</h2>

        
        <form method="POST" id="loginForm">
            <div class="mb-3">
                <input name="username" id="username" required="" placeholder="Username" class="form-control form-control-lg">
            </div>
            <div class="mb-4">
                <input name="password" type="password" required="" placeholder="Password" class="form-control form-control-lg">
            </div>
            <button type="submit" class="btn btn-success w-100 btn-lg" id="submitBtn">Login</button>
        </form>

        <p class="text-center mt-3 text-secondary">
            Don't have an account?
            <a href="../auth/register.php" class="text-decoration-none">Register here</a>
        </p>
    </div>

    <script>
        const usernameInput = document.getElementById('username');
        const errorBox = document.getElementById('error-box');
        const submitBtn = document.getElementById('submitBtn');
        let interval = null;
        let pollingUsername = '';

        function checkLockout(username) {
            if (!username) return;

            fetch(`login_check.php?username=${encodeURIComponent(username)}`)
                .then(res => res.json())
                .then(data => {
                    const remaining = data.remaining;
                    if (remaining > 0) {
                        startCountdown(remaining);
                    } else {
                        clearInterval(interval);
                        errorBox.innerText = '';
                        submitBtn.disabled = false;
                    }
                });
        }

        function startCountdown(seconds) {
            clearInterval(interval);
            let timeLeft = seconds;
            submitBtn.disabled = true;
            errorBox.innerText = `⛔ Please wait ${timeLeft} seconds...`;

            interval = setInterval(() => {
                timeLeft--;
                if (timeLeft <= 0) {
                    clearInterval(interval);
                    errorBox.innerText = '';
                    submitBtn.disabled = false;
                } else {
                    errorBox.innerText = `⛔ Please wait ${timeLeft} seconds...`;
                }
            }, 1000);
        }

        usernameInput.addEventListener('input', () => {
            const username = usernameInput.value.trim();
            pollingUsername = username;
            if (username) checkLockout(username);
        });

        window.addEventListener('load', () => {
            const initialUsername = usernameInput.value.trim();
            pollingUsername = initialUsername;
            if (initialUsername) checkLockout(initialUsername);
        });
    </script>



</body></html>